!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs/Subject"),require("@angular/common")):"function"==typeof define&&define.amd?define("ngx-drag-and-drop-lists",["exports","@angular/core","rxjs/Subject","@angular/common"],e):e(t["ngx-drag-and-drop-lists"]={},t.ng.core,t.Rx,t.ng.common)}(this,function(t,n,e,r){"use strict";var d="application/x-dnd",p="application/json",g="Text",o=["move","copy","link"],i=function(){function t(){this.dragState={isDragging:!1,itemType:undefined,dropEffect:"none",effectAllowed:o[0]}}return t.prototype.filterEffects=function(t,e){return"all"===e?t:t.filter(function(t){return-1!==e.toLowerCase().indexOf(t)})},t}();i.decorators=[{type:n.Injectable}];var h=new e.Subject,a=function(){function t(t,e){this.element=t,this.dndState=e,this.option={disabled:!1,effectAllowed:"move",allowedTypes:undefined},this.dndDragOver=new n.EventEmitter,this.dndDrop=new n.EventEmitter,this.dndInserted=new n.EventEmitter,this.listSettings={},this.dragState=e.dragState,this.nativeElement=t.nativeElement,this.placeholder=this.getPlaceholderElement()}return Object.defineProperty(t.prototype,"dndPlaceholder",{set:function(t){(this.placeholder=t).remove()},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){},t.prototype.ngOnDestroy=function(){},t.prototype.handleDragEnter=function(t){t=t.originalEvent||t;var e=this.getMimeType(t.dataTransfer.types);return!e||!this.isDropAllowed(this.getItemType(e))||(t.preventDefault(),!1)},t.prototype.handleDragOver=function(t){t=t.originalEvent||t;var e=this.getMimeType(t.dataTransfer.types),n=this.getItemType(e);if(!e||!this.isDropAllowed(n))return!0;if(this.placeholder.parentNode!==this.nativeElement&&this.nativeElement.appendChild(this.placeholder),t.target!==this.nativeElement){for(var r=t.target;r.parentNode!==this.nativeElement&&r.parentNode;)r=r.parentNode;if(r.parentNode===this.nativeElement&&r!==this.placeholder){var i=void 0,a=r.getBoundingClientRect();i=this.option&&this.option.horizontal?t.clientX<a.left+a.width/2:t.clientY<a.top+a.height/2,this.nativeElement.insertBefore(this.placeholder,i?r:r.nextSibling)}}var d=e===g,o=this.getDropEffect(t,d);return"none"===o?this.stopDragOver():(t.preventDefault(),d||(t.dataTransfer.dropEffect=o),this.nativeElement.classList.add("dndDragover"),t.stopPropagation(),!1)},t.prototype.handleDrop=function(t){t=t.originalEvent||t;var e=this.getMimeType(t.dataTransfer.types),n=this.getItemType(e);if(!e||!this.isDropAllowed(n))return!0;t.preventDefault();var r=undefined;try{r=JSON.parse(t.dataTransfer.getData(e))}catch(l){return this.stopDragOver()}if((e===g||e===p)&&(n=r.type||undefined,r=r.item,!this.isDropAllowed(n)))return this.stopDragOver();var i=e===g,a=this.getDropEffect(t,i);if("none"===a)return this.stopDragOver();var d=this.getPlaceholderIndex(),o=this.nativeElement.children.length-1-this.dndModel.length;if(this.dndDrop&&(this.invokeCallback(this.dndDrop,t,a,n,d,r),!r))return this.stopDragOver();if(this.dragState.dropEffect=a,i||(t.dataTransfer.dropEffect=a),!0!==r){var s=d-o;s<0&&(s=0),this.dndModel.splice(s,0,r)}return this.invokeCallback(this.dndInserted,t,a,n,d,r),h.next({item:r,list:this.dndModel}),this.stopDragOver(),t.stopPropagation(),!1},t.prototype.handleDragLeave=function(t){t=t.originalEvent||t;var e=document.elementFromPoint(t.clientX,t.clientY);this.nativeElement.contains(e)&&!t._dndPhShown?t._dndPhShown=!0:this.stopDragOver()},t.prototype.getPlaceholderElement=function(){var t=undefined;if(this.nativeElement.children)for(var e=1;e<this.nativeElement.children.length;e++){var n=this.nativeElement.children.item(e);n.classList.contains("dndPlaceholder")&&(t=n)}var r=document.createElement("li");return r.classList.add("dndPlaceholder"),t||r},t.prototype.getMimeType=function(t){if(!t)return g;for(var e=0;e<t.length;e++)if(t[e]===g||t[e]===p||t[e].substr(0,d.length)===d)return t[e];return null},t.prototype.getItemType=function(t){return this.dragState.isDragging?this.dragState.itemType||undefined:t===g||t===p?null:t&&t.substr(d.length+1)||undefined},t.prototype.isDropAllowed=function(t){if(this.option){if(this.option.disabled)return!1;if(this.option.max&&this.dndModel.length===this.option.max)return!1;if(!this.option.externalSources&&!this.dragState.isDragging)return!1;if(!this.option.allowedTypes||null===t)return!0}return t&&-1!==this.option.allowedTypes.indexOf(t)},t.prototype.getDropEffect=function(t,e){var n=Object.assign([],o);return e||(n=this.dndState.filterEffects(n,t.dataTransfer.effectAllowed)),this.dragState.isDragging&&(n=this.dndState.filterEffects(n,this.dragState.effectAllowed)),this.option&&this.option.effectAllowed&&(n=this.dndState.filterEffects(n,this.option.effectAllowed)),n.length?t.ctrlKey&&-1!==n.indexOf("copy")?"copy":t.altKey&&-1!==n.indexOf("link")?"link":n[0]:"none"},t.prototype.stopDragOver=function(){return this.placeholder.remove(),this.nativeElement.classList.remove("dndDragover"),!0},t.prototype.invokeCallback=function(t,e,n,r,i,a){return t.emit({dropEffect:n,event:e,external:!this.dragState.isDragging,index:i!==undefined?i:this.getPlaceholderIndex(),item:a||undefined,type:r}),!0},t.prototype.getPlaceholderIndex=function(){for(var t=0;t<this.nativeElement.children.length;t++)if(this.nativeElement.children[t].classList.contains("dndDragging")){this.nativeElement.children[t].remove();break}return Array.prototype.indexOf.call(this.nativeElement.children,this.placeholder)},t}();a.decorators=[{type:n.Directive,args:[{selector:"[dndList]"}]}],a.ctorParameters=function(){return[{type:n.ElementRef},{type:i}]},a.propDecorators={option:[{type:n.Input,args:["dndList"]}],dndModel:[{type:n.Input,args:["dndModel"]}],dndPlaceholder:[{type:n.Input}],dndDragOver:[{type:n.Output,args:["dndDragOver"]}],dndDrop:[{type:n.Output,args:["dndDrop"]}],dndInserted:[{type:n.Output,args:["dndInserted"]}],handleDragEnter:[{type:n.HostListener,args:["dragenter",["$event"]]}],handleDragOver:[{type:n.HostListener,args:["dragover",["$event"]]}],handleDrop:[{type:n.HostListener,args:["drop",["$event"]]}],handleDragLeave:[{type:n.HostListener,args:["dragleave",["$event"]]}]};var s=function(){function t(t,e){this.element=t,this.dndState=e,this.option={draggable:!0},this.dndDragStart=new n.EventEmitter,this.dndDragEnd=new n.EventEmitter,this.dndCopied=new n.EventEmitter,this.dndLinked=new n.EventEmitter,this.dndMoved=new n.EventEmitter,this.dndCanceled=new n.EventEmitter,this.dndSelected=new n.EventEmitter,this.draggableString="draggable",this.dragState=e.dragState,this.nativeElement=t.nativeElement,this.nativeElement.setAttribute(this.draggableString,"true"),this.nativeElement.onselectstart=function(){this.dragDrop&&this.dragDrop()}}return Object.defineProperty(t.prototype,"disableDrag",{set:function(t){t!==undefined&&this.nativeElement.setAttribute(this.draggableString,(!t).toString())},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var n=this;this.dropSubscription=h.subscribe(function(t){var e=t.item;t.list;if(JSON.stringify(n.dndObject)===JSON.stringify(e)){n.dragState&&n[{copy:"dndCopied",link:"dndLinked",move:"dndMoved",none:"dndCanceled"}[n.dragState.effectAllowed]].emit(),n.dndDragEnd.emit()}})},t.prototype.ngOnDestroy=function(){this.dropSubscription.unsubscribe()},t.prototype.handleDragStart=function(t){var e=this;if("false"!==this.nativeElement.getAttribute(this.draggableString)){this.dragState.isDragging=!0,this.dragState.itemType=this.dndType,this.dragState.dropEffect="none",this.option||(this.option={draggable:!0}),this.dragState.effectAllowed=this.option.effectAllowed||o[0],t.dataTransfer.effectAllowed=this.dragState.effectAllowed;var n=d+(this.dragState.itemType?"-"+this.dragState.itemType:"");try{t.dataTransfer.setData(n,JSON.stringify(this.dndObject))}catch(a){var r=JSON.stringify({item:this.dndObject,type:this.dragState.itemType});try{t.dataTransfer.setData(p,r)}catch(a){var i=this.dndState.filterEffects(o,this.dragState.effectAllowed);t.dataTransfer.effectAllowed=i[0],t.dataTransfer.setData(g,r)}}this.nativeElement.classList.add("dndDragging"),setTimeout(function(){"move"===e.dragState.effectAllowed&&(e.nativeElement.style.display="none")}),t._dndHandle&&t.dataTransfer.setDragImage&&t.dataTransfer.setDragImage(this.nativeElement,0,0),this.dndDragStart.emit(),t.stopPropagation()}},t.prototype.handleDragEnd=function(t){var e=this;this.dragState.isDragging=!1,this.nativeElement.classList.remove("dndDragging"),this.nativeElement.style.removeProperty("display"),t.stopPropagation(),setTimeout(function(){return e.nativeElement.classList.remove("dndDraggingSource")},0)},t.prototype.handleClick=function(t){this.nativeElement.hasAttribute("dndSelected")||(t=t.originalEvent||t,this.dndSelected.emit(),t.stopPropagation())},t.prototype.findElementWithAttribute=function(t,e){return t.hasAttribute(e)?t:null!==t.parentElement?this.findElementWithAttribute(t.parentElement,e):void 0},t}();s.decorators=[{type:n.Directive,args:[{selector:"[dndDraggable]"}]}],s.ctorParameters=function(){return[{type:n.ElementRef},{type:i}]},s.propDecorators={option:[{type:n.Input,args:["dndDraggable"]}],dndType:[{type:n.Input,args:["dndType"]}],dndObject:[{type:n.Input,args:["dndObject"]}],disableDrag:[{type:n.Input,args:["dndDragDisabled"]}],dndDragStart:[{type:n.Output,args:["dndDragStart"]}],dndDragEnd:[{type:n.Output,args:["dndDragEnd"]}],dndCopied:[{type:n.Output,args:["dndCopied"]}],dndLinked:[{type:n.Output,args:["dndLinked"]}],dndMoved:[{type:n.Output,args:["dndMoved"]}],dndCanceled:[{type:n.Output,args:["dndCanceled"]}],dndSelected:[{type:n.Output,args:["dndSelected"]}],handleDragStart:[{type:n.HostListener,args:["dragstart",["$event"]]}],handleDragEnd:[{type:n.HostListener,args:["dragend",["$event"]]}],handleClick:[{type:n.HostListener,args:["click",["$event"]]}]};var l=function(){function t(t,e){this.element=t,this.dndState=e,this.draggableString="draggable",this.dragState=e.dragState,this.nativeElement=t.nativeElement,this.nativeElement.setAttribute(this.draggableString,"true")}return t.prototype.handleDragStart=function(t){(t=t.originalEvent||t)._dndHandle||(t.dataTransfer.types&&t.dataTransfer.types.length||t.preventDefault(),t.stopPropagation())},t.prototype.handleDragEnd=function(t){(t=t.originalEvent||t)._dndHandle||t.stopPropagation()},t}();l.decorators=[{type:n.Directive,args:[{selector:"[dndNoDrag]"}]}],l.ctorParameters=function(){return[{type:n.ElementRef},{type:i}]},l.propDecorators={handleDragStart:[{type:n.HostListener,args:["dragstart",["$event"]]}],handleDragEnd:[{type:n.HostListener,args:["dragend",["$event"]]}]};var c=function(){function t(t,e){this.element=t,this.dndState=e,this.draggableString="draggable",this.dragState=e.dragState,this.nativeElement=t.nativeElement,this.nativeElement.setAttribute(this.draggableString,"true")}return t.prototype.handleDragStart=function(t){(t=t.originalEvent||t)._dndHandle=!0},t.prototype.handleDragEnd=function(t){(t=t.originalEvent||t)._dndHandle||t.stopPropagation()},t}();c.decorators=[{type:n.Directive,args:[{selector:"[dndHandle]"}]}],c.ctorParameters=function(){return[{type:n.ElementRef},{type:i}]},c.propDecorators={handleDragStart:[{type:n.HostListener,args:["dragstart",["$event"]]}],handleDragEnd:[{type:n.HostListener,args:["dragend",["$event"]]}]};var f=function u(){};f.decorators=[{type:n.NgModule,args:[{imports:[r.CommonModule],exports:[s,c,a,l],entryComponents:[],declarations:[s,c,a,l],providers:[i]}]}],t.DndListModule=f,t.DndDraggable=s,t.DndNoDrag=l,t.dropAccepted=h,t.DndList=a,t.DndHandle=c,t.MIME_TYPE=d,t.EDGE_MIME_TYPE=p,t.MSIE_MIME_TYPE=g,t.ALL_EFFECTS=o,t.DndState=i,t.ɵa=s,t.ɵb=c,t.ɵc=a,t.ɵd=l,t.ɵe=i,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-drag-and-drop-lists.umd.min.js.map
